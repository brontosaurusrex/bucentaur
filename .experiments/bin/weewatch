#!/bin/bash

# weewatch - mutiplex all weechat logs to one stream, as seen in sic irc client

# usage: 
#   watch -t weewatch

cd ~/.weechat/logs/ || exit

main () {
    for log in *.weechatlog; do

        baseext="${log##*/}"
        base="${baseext%.*}" 

        #echo "$base"
        
        # lets replace cat with tail for performance resons
        tail -n 100 "$log" | while read -r line; do
            echo "$line ($base)"
        done
        
    done
    }
    
main | grep -v '▬▬▶' | grep -v '◀▬▬' | sort | cut -d' ' -f2- | fold -s -w "$(tput cols)" | tail -n $(( $(tput lines) - 2 ))
