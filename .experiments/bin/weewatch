#!/bin/bash

# weewatch - mutiplex all weechat logs to one stream, as seen in sic irc client

# usage: 
#   watch -t weewatch

cd ~/.weechat/logs/ || exit

main () {
    for log in *.weechatlog; do

        baseext="${log##*/}"
        base="${baseext%.*}" 

        #echo "$base"
        
        # lets replace cat with tail for performance resons
        tail -n 100 "$log" | while read -r line; do
            echo "$line ($base)"
        done
        
    done
    }
    
# cover the non-interactive use as well?
cols="$(tput cols)" || cols="85"
lines="$(tput lines)" || lines="25" 

# run
main | grep -v '▬▬▶' | grep -v '◀▬▬' | sort | cut -d' ' -f2- | fold -s -w "$cols" | tail -n $(( lines - 1 ))
