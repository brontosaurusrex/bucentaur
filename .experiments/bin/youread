#!/bin/bash

# youread 
# read clipboard with flite, assuming input is text with some punctuations.

# needs: flite, xclip, mpv

# tmp dir
tmp="/tmp/$RANDOM-$$"
trap '[ -n "$tmp" ] && rm -fr "$tmp"' EXIT
mkdir -m 700 "$tmp" || { echo '!! unable to create a tmp dir' >&2; tmp=; exit 1; }

# store clipboard to tmp (assuming text)
#xclip -selection clipboard -o -
xclip -selection clipboard -o > "$tmp/some.txt"

# reflow so each line is sentence (assuming text)
cat "$tmp/some.txt" | tr '\r\n' ' ' | sed 's/[.!?]  */&\n/g' > "$tmp/some2.txt"
echo "" >> "$tmp/some2.txt" # add new line at the end

# loop over lines and read each
while read -r line; do

    echo "$line"
    flite -voice slt -t "$line" -o "$tmp/some.wav"
    mpv --no-config --no-video --no-resume-playback --no-ytdl "$tmp/some.wav" &>/dev/null 
    #killall flite &>/dev/null # reset flite

done < "$tmp/some2.txt"
